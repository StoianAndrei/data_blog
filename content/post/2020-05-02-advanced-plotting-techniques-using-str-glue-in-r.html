---
title: "Using str_glue() in R for Advanced Plotting"
author: "Jason Dexter"
date: '2020-05-02'
slug: advanced-plotting-techniques-using-str-glue-in-r
categories: []
tags:
- R
- stringr
- ggplot
draft: yes
editor_options:
  chunk_output_type: console
output: 
  html_document: 
    fig_height: 3
    fig_width: 8
---

<link href="/rmarkdown-libs/pagedtable/css/pagedtable.css" rel="stylesheet" />
<script src="/rmarkdown-libs/pagedtable/js/pagedtable.js"></script>


<div id="lets-dive-into-an-example" class="section level3">
<h3>Letâ€™s Dive Into an Example</h3>
<p>Iâ€™d like to share a technique using <code>str_glue()</code> that I learned from <a href="https://www.linkedin.com/in/mattdancho/" target="_blank">Matt Dancho</a>, a Data-Science instructor at Business Science University. Check out my favorite course here: <a href="http://bit.ly/2Z9SHsd" target="_blank">Business Analysis With R</a>.</p>
<p><code>str_glue()</code> from the <code>stringr</code> library is one of my favorite functions in <code>R</code> - Itâ€™s super helpful for wrangling and manipulating text in preparation for building plots.</p>
</div>
<div id="lets-get-some-data" class="section level3">
<h3>Letâ€™s Get Some Data ðŸ¤“</h3>
<p>The <a href="https://github.com/rfordatascience/tidytuesday" target="_blank">Tidy Tuesday Project</a> is an awesome repository of useful data for practicing your data <code>Wrangling</code> skills.</p>
<p>We will work with the â€˜San Francisco Treesâ€™ data as a case study for using <code>str_glue()</code> for advanced plotting techniques.</p>
<pre class="r"><code>library(tidyverse)
library(stringr)
library(tidyquant)
library(scales)

sf_trees_data_raw_tbl &lt;- readr::read_csv(&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-01-28/sf_trees.csv&#39;)</code></pre>
<p>Letâ€™s take a quick peak at the transposed table to inspect the columns and data types.</p>
<pre class="r"><code>sf_trees_data_raw_tbl %&gt;% glimpse()</code></pre>
<pre><code>## Rows: 192,987
## Columns: 12
## $ tree_id      &lt;dbl&gt; 53719, 30313, 30312, 30314, 30315, 30316, 48435, 30319, â€¦
## $ legal_status &lt;chr&gt; &quot;Permitted Site&quot;, &quot;Permitted Site&quot;, &quot;Permitted Site&quot;, &quot;Dâ€¦
## $ species      &lt;chr&gt; &quot;Tree(s) ::&quot;, &quot;Tree(s) ::&quot;, &quot;Tree(s) ::&quot;, &quot;Pittosporum uâ€¦
## $ address      &lt;chr&gt; &quot;2963 Webster St&quot;, &quot;501 Arkansas St&quot;, &quot;501 Arkansas St&quot;,â€¦
## $ site_order   &lt;dbl&gt; 1, 3, 2, 1, 5, 6, 4, 2, 1, 3, 1, 3, 1, 2, 4, 1, 1, 1, 2,â€¦
## $ site_info    &lt;chr&gt; &quot;Sidewalk: Curb side : Cutout&quot;, &quot;Sidewalk: Curb side : Câ€¦
## $ caretaker    &lt;chr&gt; &quot;Private&quot;, &quot;Private&quot;, &quot;Private&quot;, &quot;Private&quot;, &quot;Private&quot;, &quot;â€¦
## $ date         &lt;date&gt; 1955-09-19, 1955-10-20, 1955-10-20, 1955-10-20, 1955-10â€¦
## $ dbh          &lt;dbl&gt; NA, NA, NA, 16, NA, NA, NA, NA, NA, NA, 2, NA, NA, NA, Nâ€¦
## $ plot_size    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, â€¦
## $ latitude     &lt;dbl&gt; 37.79787, 37.75984, 37.75984, 37.75977, 37.79265, 37.792â€¦
## $ longitude    &lt;dbl&gt; -122.4341, -122.3981, -122.3981, -122.3981, -122.4124, -â€¦</code></pre>
<p>This is a fairly small data-set with only 12 columns. For the purpose of demonstration, letâ€™s see what we can do with just the species column.</p>
<p>The Coastal Redwoods in the SF area are incredible and one of my favorite species. Iâ€™m curious if other species of Redwoods are in SF and if so, at what proportions do they exist relative to the Coastal Redwoods.</p>
</div>
<div id="data-wrangling-data-exploration" class="section level3">
<h3>Data Wrangling + Data Exploration</h3>
<pre class="r"><code># Data Wrangling
redwood_tbl &lt;- sf_trees_data_raw_tbl %&gt;% 
    
    # select species and filter to redwood only
    select(species) %&gt;% 
    filter(str_detect(species, pattern = &#39;Redwood&#39;)) %&gt;% 
    
    # break up species and common-name into separate columns
    separate(
        col = species,
        into = c(&quot;species&quot;, &quot;common_name&quot;),
        sep  = &#39; :: &#39;,
        remove = FALSE) %&gt;% 
    
    # calculate absolute and relative distributions
    count(species, common_name) %&gt;% 
    mutate(pct = n / sum(n),
           pct_text = percent(pct)) %&gt;% 
    arrange(desc(pct))</code></pre>
</div>
<div id="summary-table" class="section level3">
<h3>Summary Table</h3>
<p>Letâ€™s take a look at our findings.</p>
<pre class="r"><code>rmarkdown::paged_table(redwood_tbl %&gt;% select(-pct))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["species"],"name":[1],"type":["chr"],"align":["left"]},{"label":["common_name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["n"],"name":[3],"type":["int"],"align":["right"]},{"label":["pct_text"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"Sequoia sempervirens","2":"Coast Redwood","3":"341","4":"92.41%"},{"1":"Metasequoia glyplostroboides","2":"Dawn Redwood","3":"15","4":"4.07%"},{"1":"Sequoiadendron giganteum","2":"Sierra Redwood","3":"13","4":"3.52%"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>As I expected, the Coastal Redwoods are the dominant species in San Francisco.</p>
<p>And while the table is good, lets craft an awesome plot to display these results.</p>
</div>
<div id="the-power-of-str_glue" class="section level3">
<h3>The Power of <code>str_glue()</code></h3>
<p>With a couple lines of <code>code</code> we can build our label for plotting. As you can see, we can add <code>arguments</code> directly from our table using curly brackets <code>{}</code> - honestly, the options are endless for how creative you can get with <code>stringing</code> together text and adding labels to your plots.</p>
<pre class="r"><code># Data Wrangling
redwood_labeled_text_tbl &lt;- redwood_tbl %&gt;% 
    
    # label text
    mutate(label_text = str_glue(
        &#39;Scientific Name:
        {species}
        Count: {n} of {sum(n)}
        Pct (%): {pct_text}&#39;
    ),
    
    # add &#39;forward-slash&#39; to wrap-text on our plots y-axis
    common_name = str_replace(common_name, pattern = &#39; &#39;, replacement = &#39; \n &#39;)) %&gt;% 
    
    # reorder factors based on percent rank
    mutate(common_name = common_name %&gt;% fct_reorder(pct))</code></pre>
<p>Here is the manipulated text that will be useful once we plot these data.</p>
<pre class="r"><code>redwood_labeled_text_tbl %&gt;% select(label_text)</code></pre>
<pre><code>## # A tibble: 3 x 1
##   label_text                                                                    
##   &lt;glue&gt;                                                                        
## 1 &quot;Scientific Name:\nSequoia sempervirens\nCount: 341 of 369\nPct (%): 92.41%&quot;  
## 2 &quot;Scientific Name:\nMetasequoia glyplostroboides\nCount: 15 of 369\nPct (%): 4â€¦
## 3 &quot;Scientific Name:\nSequoiadendron giganteum\nCount: 13 of 369\nPct (%): 3.52%&quot;</code></pre>
</div>
<div id="data-visualization" class="section level3">
<h3>Data Visualization</h3>
<p>Now that weâ€™ve done our <code>Data Wrangling</code>, lets get into a bit of <code>Data Visualization</code>.</p>
<pre class="r"><code># Save Plot
g &lt;- redwood_labeled_text_tbl %&gt;% 
    
    ggplot(aes(pct, common_name), color = &#39;#2c3e50&#39;) +
    
    # Geometries
    geom_segment(aes(xend = 0, yend = common_name), size = 2) +
    geom_point(aes(size = 5)) +
    geom_label(aes(label = label_text),hjust = &quot;inward&quot;,size = 3) +

    # Formatting
    scale_x_continuous(labels = scales::percent_format()) +
    labs(title = str_glue(&quot;Redwoods of San Francisco (SF)&quot;),
        subtitle = str_glue(
            &quot;As expected, the coastal Redwoods make up the largest proportion.
            Dawn Redwoods were once thought to be extinct and so low numbers are not suprising.
            Siera Redwoods grow at high elev. and low numbers are expected&quot;),
        caption = str_glue(&quot;The Coastal Redwood is the dominant species in SF.&quot;),
        x = &quot;&quot;, y = &quot;&quot;) +
    theme_tq() + theme(legend.position = &quot;none&quot;,
          plot.title = element_text(face = &quot;bold&quot;))</code></pre>
</div>
<div id="display-awesome-plot" class="section level2">
<h2>Display Awesome Plot</h2>
<p>And here is our plot with our the labels engineered in the last few steps. And thatâ€™s just one example of why I love <code>str_glue()</code> - Simply Awesome!</p>
<p><img src="/post/2020-05-02-advanced-plotting-techniques-using-str-glue-in-r_files/figure-html/unnamed-chunk-8-1.png" width="768" /></p>
<p>Thatâ€™s it for today!</p>
<p>Stay tuned (+connected) for more posts on Wrangling + Exploring data (<code>programatically</code>).</p>
<div id="stay-connected" class="section level3">
<h3>Stay Connected</h3>
<p>Enter your <a href="https://tinyletter.com/dexters-analytics" target="_blank">Email Here</a> to receive notifications when new content is posted.<br/></p>
<p>PS: Be Kind and Tidy your Data ðŸ˜Ž</p>
</div>
<div id="check-out-business-science" class="section level3">
<h3>Check out Business Science ðŸ‘‡</h3>
<p>Interested in expediting your learning path? Head on over to <a href="https://www.business-science.io/?affcode=173166_vnvxtqbd" target="_blank">Business Science</a> and join me on the journey.</p>
<p><a href="https://university.business-science.io/p/jumpstart-with-r/?affcode=173166_vnvxtqbd" target="_blank">Business Science: FREE Jumpstart Data-Science Course</a> (opened for a limited time)</p>
</div>
</div>
